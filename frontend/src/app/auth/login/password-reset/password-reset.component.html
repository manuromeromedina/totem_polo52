<div class="reset-password-container">
  <div class="reset-password-box">
    <!-- Loading inicial -->
    <div *ngIf="loading && !error && !message" class="loading-container">
      <i class="fas fa-spinner"></i>
      <p>Verificando enlace...</p>
    </div>

    <!-- Header con estilo del login -->
    <div *ngIf="!loading || error || message" class="header">
      <h2>
        <div class="login-icon">
          <img src="assets/images/PoloLogo-rojo.jpg" alt="Logo Polo 52" />
        </div>
        <i class="fas fa-key" style="margin-right: 12px; font-size: 1.5rem"></i>
        Restablecer Contraseña
      </h2>
      <p class="subtitle" *ngIf="!tokenExpired && token">
        Ingresa tu nueva contraseña segura
      </p>
      <p class="subtitle" *ngIf="tokenExpired">
        Enlace de recuperación expirado
      </p>
      <p class="subtitle" *ngIf="!token && !tokenExpired">
        Enlace de recuperación inválido
      </p>
    </div>

    <!-- Token expirado - Caso especial -->
    <div *ngIf="tokenExpired" class="expired-container">
      <div class="icon-container">
        <i class="fas fa-clock"></i>
      </div>
      <h3>Enlace Expirado</h3>
      <p>Este enlace de recuperación de contraseña ya no es válido.</p>
      <p class="subtitle">
        Los enlaces de recuperación expiran por seguridad después de un tiempo
        determinado.
      </p>

      <div class="button-group">
        <button type="button" class="primary-button" (click)="requestNewLink()">
          <i class="fas fa-paper-plane"></i>
          Solicitar Nuevo Enlace
        </button>
        <button type="button" class="secondary-button" (click)="goToLogin()">
          <i class="fas fa-arrow-left"></i>
          Volver al Login
        </button>
      </div>
    </div>

    <!-- Error si no hay token -->
    <div *ngIf="!token && !tokenExpired" class="error-container">
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <span>{{ error }}</span>
      </div>
      <div class="button-group">
        <button type="button" class="secondary-button" (click)="goToLogin()">
          <i class="fas fa-arrow-left"></i>
          Volver al Login
        </button>
      </div>
    </div>

    <!-- Formulario de reset (solo si hay token válido) -->
    <form
      *ngIf="token && !tokenExpired && !loading"
      #resetForm="ngForm"
      (ngSubmit)="onResetPassword(resetForm)"
    >
      <div class="form-group">
        <label for="newPassword">
          <i class="fas fa-lock"></i>
          Nueva Contraseña
        </label>
        <input
          id="newPassword"
          name="newPassword"
          type="password"
          [(ngModel)]="newPassword"
          placeholder="Mínimo 8 caracteres, 1 mayúscula, 1 número"
          required
          minlength="8"
          [class.error]="newPassword && !isPasswordValid()"
          [class.success]="newPassword && isPasswordValid()"
        />

        <!-- Indicadores de requisitos de contraseña -->
        <div *ngIf="newPassword" class="password-requirements">
          <div
            class="requirement"
            [class.valid]="getPasswordRequirements().minLength"
          >
            <i
              [class]="
                getPasswordRequirements().minLength
                  ? 'fas fa-check'
                  : 'fas fa-times'
              "
            ></i>
            Al menos 8 caracteres
          </div>
          <div
            class="requirement"
            [class.valid]="getPasswordRequirements().hasUppercase"
          >
            <i
              [class]="
                getPasswordRequirements().hasUppercase
                  ? 'fas fa-check'
                  : 'fas fa-times'
              "
            ></i>
            Una letra mayúscula
          </div>
          <div
            class="requirement"
            [class.valid]="getPasswordRequirements().hasNumber"
          >
            <i
              [class]="
                getPasswordRequirements().hasNumber
                  ? 'fas fa-check'
                  : 'fas fa-times'
              "
            ></i>
            Al menos un número
          </div>
        </div>
      </div>

      <div class="form-group">
        <label for="confirmPassword">
          <i class="fas fa-lock"></i>
          Confirmar Contraseña
        </label>
        <input
          id="confirmPassword"
          name="confirmPassword"
          type="password"
          [(ngModel)]="confirmPassword"
          placeholder="Repite la nueva contraseña"
          required
          minlength="8"
          [class.error]="confirmPassword && !doPasswordsMatch()"
          [class.success]="confirmPassword && doPasswordsMatch()"
        />
        <div
          *ngIf="confirmPassword && !doPasswordsMatch()"
          class="field-hint error"
        >
          <i class="fas fa-times"></i>
          Las contraseñas no coinciden
        </div>
        <div
          *ngIf="confirmPassword && doPasswordsMatch()"
          class="field-hint success"
        >
          <i class="fas fa-check"></i>
          Las contraseñas coinciden
        </div>
      </div>

      <div class="button-group">
        <button
          type="submit"
          class="primary-button"
          [disabled]="
            resetForm.invalid ||
            loading ||
            !isPasswordValid() ||
            !doPasswordsMatch()
          "
        >
          <i *ngIf="loading" class="fas fa-spinner fa-spin"></i>
          <i *ngIf="!loading" class="fas fa-shield-alt"></i>
          {{
            loading ? "Actualizando Contraseña..." : "Restablecer Contraseña"
          }}
        </button>

        <button type="button" class="secondary-button" (click)="goToLogin()">
          <i class="fas fa-times"></i>
          Cancelar
        </button>
      </div>
    </form>

    <!-- Mensajes de estado -->
    <div *ngIf="message" class="success-container">
      <div class="success-message">
        <i class="fas fa-check-circle"></i>
        <span>{{ message }}</span>
      </div>
    </div>

    <div *ngIf="error && token && !tokenExpired" class="error-container">
      <div class="error-message">
        <i class="fas fa-exclamation-triangle"></i>
        <span>{{ error }}</span>
      </div>
    </div>
  </div>
</div>
