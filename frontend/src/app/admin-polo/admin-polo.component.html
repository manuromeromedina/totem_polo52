<!-- admin-polo.component.html MEJORADO CON PERFIL DEL POLO -->
<div class="admin-container" [class.dark-mode]="isDarkMode">
  <!-- Header -->
  <header class="admin-header">
    <div class="header-content">
      <div class="logo-section">
        <h1>Panel Administrativo - Polo 52</h1>
        <p *ngIf="poloData">{{ poloData.nombre }} - {{ poloData.rubro }}</p>
        <p *ngIf="!poloData">Gestión integral del parque industrial</p>
      </div>
      <div class="header-actions">
        <button
          (click)="toggleDarkMode()"
          aria-label="Cambiar modo claro/oscuro"
          class="mode-toggle-btn"
        >
          <svg
            *ngIf="isDarkMode"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="feather feather-sun"
            viewBox="0 0 24 24"
          >
            <circle cx="12" cy="12" r="5"></circle>
            <line x1="12" y1="1" x2="12" y2="3"></line>
            <line x1="12" y1="21" x2="12" y2="23"></line>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
            <line x1="1" y1="12" x2="3" y2="12"></line>
            <line x1="21" y1="12" x2="23" y2="12"></line>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
          </svg>

          <svg
            *ngIf="!isDarkMode"
            xmlns="http://www.w3.org/2000/svg"
            width="24"
            height="24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
            stroke-linecap="round"
            stroke-linejoin="round"
            class="feather feather-moon"
            viewBox="0 0 24 24"
          >
            <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
          </svg>
        </button>

        <app-logout-button></app-logout-button>
      </div>
    </div>
  </header>

  <!-- Navigation Tabs -->
  <nav class="tab-navigation">
    <button
      class="tab-button"
      [class.active]="activeTab === 'perfil'"
      (click)="setActiveTab('perfil')"
    >
      Perfil Polo
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'empresas'"
      (click)="setActiveTab('empresas')"
    >
      Empresas
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'usuarios'"
      (click)="setActiveTab('usuarios')"
    >
      Usuarios
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'servicios'"
      (click)="setActiveTab('servicios')"
    >
      Servicios del Polo
    </button>
    <button
      class="tab-button"
      [class.active]="activeTab === 'lotes'"
      (click)="setActiveTab('lotes')"
    >
      Lotes
    </button>
  </nav>

  <!-- Message Display -->
  <div *ngIf="message" class="message" [class]="messageType">
    {{ message }}
  </div>

  <!-- Loading Indicator -->
  <div
    *ngIf="loading && !poloData && activeTab === 'perfil'"
    class="loading-container"
  >
    <div class="loading-spinner"></div>
    <p>Cargando datos del polo...</p>
  </div>

  <!-- Main Content -->
  <main class="main-content">
    <!-- PERFIL POLO TAB -->
    <div *ngIf="activeTab === 'perfil'" class="tab-content">
      <div class="section-header">
        <h2>Perfil del Polo</h2>
        <div class="header-actions">
          <button class="btn btn-secondary" (click)="openPasswordForm()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"
              />
            </svg>
            Cambiar Contraseña
          </button>
          <button class="btn btn-primary" (click)="openPoloEditForm()">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3-6.5 6.5v3h3l6.5-6.5z"
              />
            </svg>
            Editar Datos
          </button>
        </div>
      </div>

      <!-- Polo Info Card -->
      <div class="info-card" *ngIf="poloData">
        <div class="card-header">
          <h3>Información General del Polo</h3>
        </div>
        <div class="card-content">
          <div class="info-grid">
            <div class="info-item">
              <label>CUIL:</label>
              <span>{{ poloData.cuil }}</span>
            </div>
            <div class="info-item">
              <label>Nombre:</label>
              <span>{{ poloData.nombre }}</span>
            </div>
            <div class="info-item">
              <label>Rubro:</label>
              <span>{{ poloData.rubro }}</span>
            </div>
            <div class="info-item">
              <label>Cantidad de Empleados:</label>
              <span>{{ poloData.cant_empleados }}</span>
            </div>
            <div class="info-item">
              <label>Fecha de Ingreso:</label>
              <span>{{ poloData.fecha_ingreso | date : "dd/MM/yyyy" }}</span>
            </div>
            <div class="info-item">
              <label>Horario de Trabajo:</label>
              <span>{{ poloData.horario_trabajo }}</span>
            </div>
            <div class="info-item full-width" *ngIf="poloData.observaciones">
              <label>Observaciones:</label>
              <span>{{ poloData.observaciones }}</span>
            </div>
          </div>
        </div>
      </div>

      <div class="stats-grid" *ngIf="poloData">
        <!-- Empresas -->
        <div class="stat-card">
          <div class="stat-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"
              />
              <path
                fill-rule="evenodd"
                d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z"
              />
              <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
            </svg>
          </div>
          <div class="stat-info">
            <h4>{{ poloData.empresas.length }}</h4>
            <p>Empresas</p>
          </div>
        </div>

        <!-- Servicios del Polo -->
        <div class="stat-card">
          <div class="stat-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3zm11 1H3v10h10V4z"
              />
              <path d="M5 7h6v2H5V7z" />
            </svg>
          </div>
          <div class="stat-info">
            <h4>{{ poloData.servicios_polo.length }}</h4>
            <p>Servicios del Polo</p>
          </div>
        </div>

        <!-- Usuarios -->
        <div class="stat-card">
          <div class="stat-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm5-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"
              />
            </svg>
          </div>
          <div class="stat-info">
            <h4>{{ poloData.usuarios.length }}</h4>
            <p>Usuarios</p>
          </div>
        </div>

        <!-- Lotes -->
        <div class="stat-card">
          <div class="stat-icon">
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="32"
              height="32"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M2.5 3A1.5 1.5 0 0 0 1 4.5v.793c.026.009.051.02.076.032L7.674 8.51c.206.1.446.1.652 0l6.598-3.185A.755.755 0 0 1 15 5.293V4.5A1.5 1.5 0 0 0 13.5 3h-11Z"
              />
              <path
                d="M15 6.954 8.978 9.86a2.25 2.25 0 0 1-1.956 0L1 6.954V11.5A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5V6.954Z"
              />
            </svg>
          </div>
          <div class="stat-info">
            <h4>{{ poloData.lotes.length }}</h4>
            <p>Lotes</p>
          </div>
        </div>
      </div>
    </div>

    <!-- EMPRESAS TAB -->
    <div *ngIf="activeTab === 'empresas'" class="tab-content">
      <div class="section-header">
        <h2>Gestión de Empresas</h2>
        <button class="btn btn-primary" (click)="openEmpresaForm()">
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="16"
            height="16"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"
            />
          </svg>
          Nueva Empresa
        </button>
      </div>

      <!-- Barra de búsqueda para Empresas -->
      <div class="search-bar">
        <div class="search-container">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
            />
          </svg>
          <input
            type="text"
            [(ngModel)]="empresaSearchTerm"
            (input)="filterEmpresas()"
            placeholder="Buscar empresas por nombre, CUIL o rubro..."
            class="search-input"
          />
          <button
            *ngIf="empresaSearchTerm"
            (click)="clearEmpresaSearch()"
            class="clear-search-btn"
            type="button"
          >
            ×
          </button>
        </div>
        <div class="search-results" *ngIf="empresaSearchTerm">
          <small
            >{{ filteredEmpresas.length }} de
            {{ empresas.length }} empresas</small
          >
        </div>
      </div>

      <!-- Empresas List -->
      <div class="data-table">
        <div class="table-header">
          <h3>Empresas Registradas</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>CUIL</th>
                <th>Nombre</th>
                <th>Rubro</th>
                <th>Empleados</th>
                <th>Fecha Ingreso</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let empresa of filteredEmpresas">
                <td>{{ empresa.cuil }}</td>
                <td>{{ empresa.nombre }}</td>
                <td>{{ empresa.rubro }}</td>
                <td>{{ empresa.cant_empleados }}</td>
                <td>{{ empresa.fecha_ingreso | date : "dd/MM/yyyy" }}</td>
                <td class="actions">
                  <div class="action-buttons">
                    <!-- Acciones principales -->
                    <div class="primary-actions">
                      <button
                        class="btn btn-sm btn-secondary"
                        (click)="openEmpresaForm(empresa)"
                        title="Editar empresa"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3-6.5 6.5v3h3l6.5-6.5z"
                          />
                        </svg>
                        Editar
                      </button>
                      <button
                        class="btn btn-sm btn-danger"
                        (click)="deleteEmpresa(empresa.cuil)"
                        title="Eliminar empresa"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"
                          />
                          <path
                            fill-rule="evenodd"
                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"
                          />
                        </svg>
                        Eliminar
                      </button>
                    </div>

                    <!-- Acciones secundarias -->
                    <div class="secondary-actions">
                      <button
                        class="btn btn-xs btn-success"
                        (click)="createUsuarioForEmpresa(empresa)"
                        title="Crear usuario para esta empresa"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="12"
                          height="12"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6zm2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0zm4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4zm-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664h10z"
                          />
                        </svg>
                        Usuario
                      </button>
                      <button
                        class="btn btn-xs btn-info"
                        (click)="createServicioPoloForEmpresa(empresa)"
                        title="Crear servicio del polo para esta empresa"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="12"
                          height="12"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3zm11 1H3v10h10V4z"
                          />
                          <path d="M5 7h6v2H5V7z" />
                        </svg>
                        Servicio
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredEmpresas.length === 0">
                <td colspan="6" class="text-center">
                  <div class="empty-state">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="48"
                      height="48"
                      fill="currentColor"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"
                      />
                      <path
                        fill-rule="evenodd"
                        d="M5.216 14A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216z"
                      />
                      <path d="M4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5z" />
                    </svg>
                    <p>
                      {{
                        empresaSearchTerm
                          ? "No se encontraron empresas"
                          : "No hay empresas registradas"
                      }}
                    </p>
                    <small *ngIf="empresaSearchTerm"
                      >Prueba con otros términos de búsqueda</small
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- USUARIOS TAB -->
    <div *ngIf="activeTab === 'usuarios'" class="tab-content">
      <div class="section-header">
        <h2>Gestión de Usuarios</h2>
      </div>

      <!-- Barra de búsqueda para Usuarios -->
      <div class="search-bar">
        <div class="search-container">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
            />
          </svg>
          <input
            type="text"
            [(ngModel)]="usuarioSearchTerm"
            (input)="filterUsuarios()"
            placeholder="Buscar usuarios por nombre, email o CUIL..."
            class="search-input"
          />
          <button
            *ngIf="usuarioSearchTerm"
            (click)="clearUsuarioSearch()"
            class="clear-search-btn"
            type="button"
          >
            ×
          </button>
        </div>
        <div class="search-results" *ngIf="usuarioSearchTerm">
          <small
            >{{ filteredUsuarios.length }} de
            {{ usuarios.length }} usuarios</small
          >
        </div>
      </div>

      <!-- Usuarios List -->
      <div class="data-table">
        <div class="table-header">
          <h3>Usuarios Registrados</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>Email</th>
                <th>CUIL Empresa</th>
                <th>Estado</th>
                <th>Fecha Registro</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let usuario of filteredUsuarios">
                <td>{{ usuario.nombre }}</td>
                <td>{{ usuario.email }}</td>
                <td>{{ usuario.cuil }}</td>
                <td>
                  <span
                    class="badge"
                    [class]="usuario.estado ? 'badge-success' : 'badge-danger'"
                  >
                    {{ usuario.estado ? "Activo" : "Inactivo" }}
                  </span>
                </td>
                <td>{{ usuario.fecha_registro | date : "dd/MM/yyyy" }}</td>
                <td class="actions">
                  <div class="action-buttons">
                    <div class="primary-actions">
                      <button
                        class="btn btn-sm btn-secondary"
                        (click)="openUsuarioForm(usuario)"
                        title="Editar usuario"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M12.146.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1 0 .708L10.5 8.207l-3-3L12.146.146zM11.207 9l-3-3-6.5 6.5v3h3l6.5-6.5z"
                          />
                        </svg>
                        Editar
                      </button>
                      <button
                        class="btn btn-sm btn-toggle-estado"
                        [class]="usuario.estado ? 'btn-warning' : 'btn-success'"
                        (click)="toggleUsuarioEstado(usuario)"
                        [title]="
                          usuario.estado
                            ? 'Inhabilitar usuario'
                            : 'Habilitar usuario'
                        "
                      >
                        <svg
                          *ngIf="usuario.estado"
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M13.359 11.238C15.06 9.72 16 8 16 8s-3-5.5-8-5.5a7.028 7.028 0 0 0-2.79.588l.77.771A5.944 5.944 0 0 1 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.134 13.134 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755-.165.165-.337.328-.517.486l.708.709z"
                          />
                          <path
                            d="M11.297 9.176a3.5 3.5 0 0 0-4.474-4.474l.823.823a2.5 2.5 0 0 1 2.829 2.829l.822.822zm-2.943 1.299.822.822a3.5 3.5 0 0 1-4.474-4.474l.823.823a2.5 2.5 0 0 0 2.829 2.829z"
                          />
                          <path
                            d="M3.35 5.47c-.18.16-.353.322-.518.487A13.134 13.134 0 0 0 1.172 8l.195.288c.335.48.83 1.12 1.465 1.755C4.121 11.332 5.881 12.5 8 12.5c.716 0 1.39-.133 2.02-.36l.77.772A7.029 7.029 0 0 1 8 13.5C3 13.5 0 8 0 8s.939-1.721 2.641-3.238l.708.708zm10.296 8.884-12-12 .708-.708 12 12-.708.708z"
                          />
                        </svg>
                        <svg
                          *ngIf="!usuario.estado"
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z"
                          />
                          <path
                            d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z"
                          />
                        </svg>
                        {{ usuario.estado ? "Inhabilitar" : "Habilitar" }}
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredUsuarios.length === 0">
                <td colspan="6" class="text-center">
                  <div class="empty-state">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="48"
                      height="48"
                      fill="currentColor"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6z"
                      />
                    </svg>
                    <p>
                      {{
                        usuarioSearchTerm
                          ? "No se encontraron usuarios"
                          : "No hay usuarios registrados"
                      }}
                    </p>
                    <small *ngIf="usuarioSearchTerm"
                      >Prueba con otros términos de búsqueda</small
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- SERVICIOS DEL POLO TAB -->
    <div *ngIf="activeTab === 'servicios'" class="tab-content">
      <div class="section-header">
        <h2>Servicios del Polo</h2>
      </div>

      <!-- Barra de búsqueda para Servicios -->
      <div class="search-bar">
        <div class="search-container">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
            />
          </svg>
          <input
            type="text"
            [(ngModel)]="servicioSearchTerm"
            (input)="filterServicios()"
            placeholder="Buscar servicios por nombre, CUIL o propietario..."
            class="search-input"
          />
          <button
            *ngIf="servicioSearchTerm"
            (click)="clearServicioSearch()"
            class="clear-search-btn"
            type="button"
          >
            ×
          </button>
        </div>
        <div class="search-results" *ngIf="servicioSearchTerm">
          <small
            >{{ filteredServicios.length }} de
            {{ serviciosPolo.length }} servicios</small
          >
        </div>
      </div>

      <!-- Servicios Polo List -->
      <div class="data-table">
        <div class="table-header">
          <h3>Servicios del Polo</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Nombre</th>
                <th>CUIL Empresa</th>
                <th>Horario</th>
                <th>Propietario</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let servicio of filteredServicios">
                <td>{{ servicio.nombre }}</td>
                <td>{{ servicio.cuil }}</td>
                <td>{{ servicio.horario || "No especificado" }}</td>
                <td>{{ servicio.propietario || "No especificado" }}</td>
                <td class="actions">
                  <div class="action-buttons">
                    <div class="primary-actions">
                      <button
                        class="btn btn-sm btn-success"
                        (click)="openLoteForm(servicio.id_servicio_polo)"
                        title="Crear lote para este servicio"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"
                          />
                        </svg>
                        Crear Lote
                      </button>
                      <button
                        class="btn btn-sm btn-danger"
                        (click)="deleteServicioPolo(servicio.id_servicio_polo)"
                        title="Eliminar servicio"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"
                          />
                          <path
                            fill-rule="evenodd"
                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"
                          />
                        </svg>
                        Eliminar
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredServicios.length === 0">
                <td colspan="5" class="text-center">
                  <div class="empty-state">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="48"
                      height="48"
                      fill="currentColor"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M2 3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3zm11 1H3v10h10V4z"
                      />
                    </svg>
                    <p>
                      {{
                        servicioSearchTerm
                          ? "No se encontraron servicios"
                          : "No hay servicios del polo registrados"
                      }}
                    </p>
                    <small *ngIf="servicioSearchTerm"
                      >Prueba con otros términos de búsqueda</small
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- LOTES TAB -->
    <div *ngIf="activeTab === 'lotes'" class="tab-content">
      <div class="section-header">
        <h2>Gestión de Lotes</h2>
      </div>

      <!-- Barra de búsqueda para Lotes -->
      <div class="search-bar">
        <div class="search-container">
          <svg
            class="search-icon"
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            fill="currentColor"
            viewBox="0 0 16 16"
          >
            <path
              d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"
            />
          </svg>
          <input
            type="text"
            [(ngModel)]="loteSearchTerm"
            (input)="filterLotes()"
            placeholder="Buscar lotes por dueño, número de lote o manzana..."
            class="search-input"
          />
          <button
            *ngIf="loteSearchTerm"
            (click)="clearLoteSearch()"
            class="clear-search-btn"
            type="button"
          >
            ×
          </button>
        </div>
        <div class="search-results" *ngIf="loteSearchTerm">
          <small>{{ filteredLotes.length }} de {{ lotes.length }} lotes</small>
        </div>
      </div>

      <!-- Lotes List -->
      <div class="data-table">
        <div class="table-header">
          <h3>Lotes Registrados</h3>
        </div>
        <div class="table-container">
          <table>
            <thead>
              <tr>
                <th>Dueño</th>
                <th>Lote</th>
                <th>Manzana</th>
                <th>ID Servicio Polo</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let lote of filteredLotes">
                <td>{{ lote.dueno }}</td>
                <td>{{ lote.lote }}</td>
                <td>{{ lote.manzana }}</td>
                <td>{{ lote.id_servicio_polo }}</td>
                <td class="actions">
                  <div class="action-buttons">
                    <div class="primary-actions">
                      <button
                        class="btn btn-sm btn-danger"
                        (click)="deleteLote(lote.id_lotes)"
                        title="Eliminar lote"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          width="14"
                          height="14"
                          fill="currentColor"
                          viewBox="0 0 16 16"
                        >
                          <path
                            d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"
                          />
                          <path
                            fill-rule="evenodd"
                            d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"
                          />
                        </svg>
                        Eliminar
                      </button>
                    </div>
                  </div>
                </td>
              </tr>
              <tr *ngIf="filteredLotes.length === 0">
                <td colspan="5" class="text-center">
                  <div class="empty-state">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="48"
                      height="48"
                      fill="currentColor"
                      viewBox="0 0 16 16"
                    >
                      <path
                        d="M2.5 3A1.5 1.5 0 0 0 1 4.5v.793c.026.009.051.02.076.032L7.674 8.51c.206.1.446.1.652 0l6.598-3.185A.755.755 0 0 1 15 5.293V4.5A1.5 1.5 0 0 0 13.5 3h-11Z"
                      />
                      <path
                        d="M15 6.954 8.978 9.86a2.25 2.25 0 0 1-1.956 0L1 6.954V11.5A1.5 1.5 0 0 0 2.5 13h11a1.5 1.5 0 0 0 1.5-1.5V6.954Z"
                      />
                    </svg>
                    <p>
                      {{
                        loteSearchTerm
                          ? "No se encontraron lotes"
                          : "No hay lotes registrados"
                      }}
                    </p>
                    <small *ngIf="loteSearchTerm"
                      >Prueba con otros términos de búsqueda</small
                    >
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- FORMULARIOS MODALES -->

    <!-- Enhanced Password Change Modal -->
    <div *ngIf="showPasswordForm" class="password-modal-overlay">
      <div class="password-modal-container">
        <!-- Header con gradiente similar al reset password -->
        <div class="password-modal-header">
          <h2>Cambiar Contraseña</h2>
          <p class="header-subtitle">
            Solicitar enlace de cambio de contraseña
          </p>
          <button
            class="modal-close-btn"
            (click)="resetForms()"
            aria-label="Cerrar modal"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="24"
              height="24"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L8 7.293 2.854 2.146z"
              />
            </svg>
          </button>
        </div>

        <!-- Error Display mejorado -->
        <div
          *ngIf="hasFieldError('password', 'general')"
          class="password-error-container"
        >
          <div
            class="password-error-message"
            *ngFor="let error of getFieldErrors('password', 'general')"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="20"
              height="20"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"
              />
            </svg>
            {{ error.message }}
          </div>
        </div>

        <!-- Content mejorado -->
        <div class="password-modal-content">
          <!-- Info box con mejor diseño -->
          <div class="password-info-card">
            <div class="info-icon-container">
              <svg
                xmlns="http://www.w3.org/2000/svg"
                width="32"
                height="32"
                fill="currentColor"
                viewBox="0 0 16 16"
              >
                <path
                  d="M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 14H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"
                />
              </svg>
            </div>
            <div class="info-text-content">
              <h3>Solicitud de Cambio de Contraseña</h3>
              <p>
                Se enviará un enlace seguro de cambio de contraseña a tu email
                registrado.
              </p>
              <div class="info-details">
                <div class="detail-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
                    />
                  </svg>
                  <span>Revisa tu bandeja de entrada</span>
                </div>
                <div class="detail-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"
                    />
                  </svg>
                  <span>Verifica también la carpeta de spam</span>
                </div>
                <div class="detail-item">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    viewBox="0 0 16 16"
                  >
                    <path
                      d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"
                    />
                    <path
                      d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"
                    />
                  </svg>
                  <span>El enlace expira en 24 horas</span>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Footer con botones mejorados -->
        <div class="password-modal-footer">
          <button
            type="button"
            class="modal-btn modal-btn-secondary"
            (click)="resetForms()"
            [disabled]="loading"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L8 7.293 2.854 2.146z"
              />
            </svg>
            Cancelar
          </button>

          <button
            type="button"
            class="modal-btn modal-btn-primary"
            (click)="onSubmitPassword()"
            [disabled]="loading"
            [class.loading]="loading"
          >
            <svg
              *ngIf="!loading"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555ZM0 4.697v7.104l5.803-3.558L0 4.697ZM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757Zm3.436-.586L16 11.801V4.697l-5.803 3.546Z"
              />
            </svg>
            <svg
              *ngIf="loading"
              class="loading-spinner"
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M11.534 7h3.932a.25.25 0 0 1 .192.41l-1.966 2.36a.25.25 0 0 1-.384 0l-1.966-2.36a.25.25 0 0 1 .192-.41zm-11 2h3.932a.25.25 0 0 0 .192-.41L2.692 6.23a.25.25 0 0 0-.384 0L.342 8.59A.25.25 0 0 0 .534 9z"
              />
              <path
                fill-rule="evenodd"
                d="M8 3c-1.552 0-2.94.707-3.857 1.818a.5.5 0 1 1-.771-.636A6.002 6.002 0 0 1 13.917 7H12.9A5.002 5.002 0 0 0 8 3zM3.1 9a5.002 5.002 0 0 0 8.757 2.182.5.5 0 1 1 .771.636A6.002 6.002 0 0 1 2.083 9H3.1z"
              />
            </svg>
            {{ loading ? "Enviando..." : "Enviar Email" }}
          </button>
        </div>
      </div>
    </div>

    <!-- Polo Edit Form Modal -->
    <div *ngIf="showPoloEditForm" class="form-modal">
      <div class="form-container">
        <div class="form-header">
          <h3>Editar Datos del Polo</h3>
          <button class="close-btn" (click)="resetForms()">&times;</button>
        </div>

        <!-- Error Display -->
        <div *ngIf="hasFieldError('polo', 'general')" class="error-display">
          <div
            class="error-message"
            *ngFor="let error of getFieldErrors('polo', 'general')"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="16"
              height="16"
              fill="currentColor"
              viewBox="0 0 16 16"
            >
              <path
                d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM5.354 4.646a.5.5 0 1 0-.708.708L7.293 8l-2.647 2.646a.5.5 0 0 0 .708.708L8 8.707l2.646 2.647a.5.5 0 0 0 .708-.708L8.707 8l2.647-2.646a.5.5 0 0 0-.708-.708L8 7.293 5.354 4.646z"
              />
            </svg>
            {{ error.message }}
          </div>
        </div>

        <form (ngSubmit)="onSubmitPoloEdit()" #poloEditFormRef="ngForm">
          <div class="form-grid">
            <div
              class="form-group"
              [class.has-error]="hasFieldError('polo', 'cant_empleados')"
            >
              <label for="cant_empleados">Cantidad de Empleados *</label>
              <input
                type="number"
                id="cant_empleados"
                name="cant_empleados"
                [(ngModel)]="poloEditForm.cant_empleados"
                required
                min="1"
                class="form-control"
                [class.error]="hasFieldError('polo', 'cant_empleados')"
              />
              <div
                *ngIf="hasFieldError('polo', 'cant_empleados')"
                class="field-error"
              >
                <span
                  *ngFor="let error of getFieldErrors('polo', 'cant_empleados')"
                  >{{ error.message }}</span
                >
              </div>
            </div>

            <div
              class="form-group"
              [class.has-error]="hasFieldError('polo', 'horario_trabajo')"
            >
              <label for="horario_trabajo">Horario de Trabajo *</label>
              <input
                type="text"
                id="horario_trabajo"
                name="horario_trabajo"
                [(ngModel)]="poloEditForm.horario_trabajo"
                required
                class="form-control"
                [class.error]="hasFieldError('polo', 'horario_trabajo')"
              />
              <div
                *ngIf="hasFieldError('polo', 'horario_trabajo')"
                class="field-error"
              >
                <span
                  *ngFor="
                    let error of getFieldErrors('polo', 'horario_trabajo')
                  "
                  >{{ error.message }}</span
                >
              </div>
            </div>

            <div
              class="form-group full-width"
              [class.has-error]="hasFieldError('polo', 'observaciones')"
            >
              <label for="observaciones">Observaciones</label>
              <textarea
                id="observaciones"
                name="observaciones"
                [(ngModel)]="poloEditForm.observaciones"
                rows="4"
                class="form-control"
                [class.error]="hasFieldError('polo', 'observaciones')"
              ></textarea>
              <div
                *ngIf="hasFieldError('polo', 'observaciones')"
                class="field-error"
              >
                <span
                  *ngFor="let error of getFieldErrors('polo', 'observaciones')"
                  >{{ error.message }}</span
                >
              </div>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="resetForms()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="loading || poloEditFormRef.invalid"
              [class.loading]="loading"
            >
              {{ loading ? "Guardando..." : "Actualizar Datos" }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Empresa Form Modal -->
    <div *ngIf="showEmpresaForm" class="form-modal">
      <div class="form-container">
        <div class="form-header">
          <h3>{{ editingEmpresa ? "Editar Empresa" : "Nueva Empresa" }}</h3>
          <button class="close-btn" (click)="resetForms()">&times;</button>
        </div>

        <form (ngSubmit)="onSubmitEmpresa()" #empresaFormRef="ngForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="cuil">CUIL *</label>
              <input
                type="number"
                id="cuil"
                name="cuil"
                [(ngModel)]="empresaForm.cuil"
                required
                [disabled]="!!editingEmpresa"
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="nombre">Nombre *</label>
              <input
                type="text"
                id="nombre"
                name="nombre"
                [(ngModel)]="empresaForm.nombre"
                required
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="rubro">Rubro *</label>
              <input
                type="text"
                id="rubro"
                name="rubro"
                [(ngModel)]="empresaForm.rubro"
                required
                class="form-control"
              />
            </div>

            <div class="form-group" *ngIf="!editingEmpresa">
              <label for="cant_empleados">Cantidad de Empleados *</label>
              <input
                type="number"
                id="cant_empleados"
                name="cant_empleados"
                [(ngModel)]="empresaForm.cant_empleados"
                required
                min="1"
                class="form-control"
              />
            </div>

            <div class="form-group full-width" *ngIf="!editingEmpresa">
              <label for="horario_trabajo">Horario de Trabajo *</label>
              <input
                type="text"
                id="horario_trabajo"
                name="horario_trabajo"
                [(ngModel)]="empresaForm.horario_trabajo"
                required
                placeholder="Ej: Lunes a Viernes 8:00 - 17:00"
                class="form-control"
              />
            </div>

            <div class="form-group full-width" *ngIf="!editingEmpresa">
              <label for="observaciones">Observaciones</label>
              <textarea
                id="observaciones"
                name="observaciones"
                [(ngModel)]="empresaForm.observaciones"
                rows="3"
                class="form-control"
              ></textarea>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="resetForms()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="loading || empresaFormRef.invalid"
            >
              {{
                loading
                  ? "Guardando..."
                  : !!editingEmpresa
                  ? "Actualizar"
                  : "Crear"
              }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Usuario Form Modal -->
    <div *ngIf="showUsuarioForm" class="form-modal">
      <div class="form-container">
        <div class="form-header">
          <h3>{{ editingUsuario ? "Editar Usuario" : "Nuevo Usuario" }}</h3>
          <button class="close-btn" (click)="resetForms()">&times;</button>
        </div>

        <form (ngSubmit)="onSubmitUsuario()" #usuarioFormRef="ngForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="user_email">Email *</label>
              <input
                type="email"
                id="user_email"
                name="user_email"
                [(ngModel)]="usuarioForm.email"
                required
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="user_nombre">Nombre de Usuario *</label>
              <input
                type="text"
                id="user_nombre"
                name="user_nombre"
                [(ngModel)]="usuarioForm.nombre"
                required
                [disabled]="!!editingUsuario"
                class="form-control"
              />
            </div>

            <!-- Solo mostrar campo de contraseña al EDITAR -->
            <div class="form-group" *ngIf="editingUsuario">
              <label for="user_password_edit">Nueva Contraseña</label>
              <input
                type="password"
                id="user_password_edit"
                name="user_password_edit"
                [(ngModel)]="usuarioForm.password"
                class="form-control"
                placeholder="Dejar vacío para mantener la actual"
              />
            </div>

            <!-- Mensaje informativo para usuarios nuevos -->
            <div class="form-group full-width" *ngIf="!editingUsuario">
              <div class="info-box">
                <div class="info-icon">🔐</div>
                <div class="info-content">
                  <h4>Contraseña Automática</h4>
                  <p>
                    Se generará una contraseña segura automáticamente y se
                    enviará por email al usuario junto con sus credenciales de
                    acceso.
                  </p>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label for="user_cuil">CUIL de Empresa *</label>
              <input
                type="number"
                id="user_cuil"
                name="user_cuil"
                [(ngModel)]="usuarioForm.cuil"
                required
                [disabled]="!!editingUsuario || creatingForEmpresa"
                class="form-control"
              />
              <small *ngIf="selectedEmpresa" class="text-muted">
                Asociado a: {{ selectedEmpresa.nombre }}
              </small>
            </div>

            <div class="form-group" *ngIf="!editingUsuario">
              <label for="user_rol">Rol *</label>
              <select
                id="user_rol"
                name="user_rol"
                [(ngModel)]="usuarioForm.id_rol"
                required
                class="form-control"
              >
                <option value="0">Seleccionar rol</option>
                <option *ngFor="let rol of roles" [value]="rol.id_rol">
                  {{ rol.tipo_rol }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label class="checkbox-label">
                <input
                  type="checkbox"
                  name="user_estado"
                  [(ngModel)]="usuarioForm.estado"
                />
                Usuario Activo
              </label>
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="resetForms()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="loading || usuarioFormRef.invalid"
            >
              {{
                loading
                  ? "Guardando..."
                  : !!editingUsuario
                  ? "Actualizar"
                  : "Crear Usuario"
              }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Lote Form Modal -->
    <div *ngIf="showLoteForm" class="form-modal">
      <div class="form-container">
        <div class="form-header">
          <h3>Nuevo Lote</h3>
          <button class="close-btn" (click)="resetForms()">&times;</button>
        </div>

        <form (ngSubmit)="onSubmitLote()" #loteFormRef="ngForm">
          <div class="form-grid">
            <div class="form-group">
              <label for="lote_dueno">Dueño *</label>
              <input
                type="text"
                id="lote_dueno"
                name="lote_dueno"
                [(ngModel)]="loteForm.dueno"
                required
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="lote_numero">Número de Lote *</label>
              <input
                type="number"
                id="lote_numero"
                name="lote_numero"
                [(ngModel)]="loteForm.lote"
                required
                min="1"
                class="form-control"
              />
            </div>

            <div class="form-group">
              <label for="lote_manzana">Manzana *</label>
              <input
                type="number"
                id="lote_manzana"
                name="lote_manzana"
                [(ngModel)]="loteForm.manzana"
                required
                min="1"
                class="form-control"
              />
            </div>
          </div>

          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="resetForms()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="loading || loteFormRef.invalid"
            >
              {{ loading ? "Guardando..." : "Crear Lote" }}
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Servicio Polo Form Modal -->
    <div *ngIf="showServicioPoloForm" class="form-modal">
      <div class="form-container">
        <div class="form-header">
          <h3>Nuevo Servicio del Polo</h3>
          <button class="close-btn" (click)="resetForms()">&times;</button>
        </div>

        <form (ngSubmit)="onSubmitServicioPolo()" #servicioFormRef="ngForm">
          <div class="form-grid">
            <!-- Nombre -->
            <div class="form-group">
              <label for="servicio_nombre">Nombre *</label>
              <input
                type="text"
                id="servicio_nombre"
                name="servicio_nombre"
                [(ngModel)]="servicioPoloForm.nombre"
                required
                class="form-control"
              />
            </div>

            <!-- CUIL -->
            <div class="form-group">
              <label for="servicio_cuil">CUIL Empresa *</label>
              <input
                type="number"
                id="servicio_cuil"
                name="servicio_cuil"
                [(ngModel)]="servicioPoloForm.cuil"
                required
                [disabled]="creatingForEmpresa"
                class="form-control"
              />
              <small *ngIf="selectedEmpresa" class="text-muted">
                Asociado a: {{ selectedEmpresa.nombre }}
              </small>
            </div>

            <!-- Horario -->
            <div class="form-group">
              <label for="servicio_horario">Horario</label>
              <input
                type="text"
                id="servicio_horario"
                name="servicio_horario"
                [(ngModel)]="servicioPoloForm.horario"
                class="form-control"
              />
            </div>

            <!-- Propietario -->
            <div class="form-group">
              <label for="servicio_propietario">Propietario *</label>
              <select
                id="servicio_propietario"
                name="servicio_propietario"
                [(ngModel)]="servicioPoloForm.propietario"
                (change)="onPropietarioChange()"
                required
                class="form-control"
              >
                <option value="">Seleccione</option>
                <option value="propietario">Propietario</option>
                <option value="inquilino">Inquilino</option>
              </select>
            </div>

            <!-- Tipo de Servicio -->
            <div class="form-group">
              <label for="tipo_servicio_polo">Tipo de Servicio *</label>
              <select
                id="tipo_servicio_polo"
                name="tipo_servicio_polo"
                [(ngModel)]="servicioPoloForm.id_tipo_servicio_polo"
                (change)="onTipoServicioChange()"
                required
                class="form-control"
              >
                <option [ngValue]="1">Coworking</option>
                <option [ngValue]="2">Nave</option>
                <option [ngValue]="3">Oficina</option>
                <option [ngValue]="4">Local Comercial</option>
                <option [ngValue]="5">Container</option>
                <option [ngValue]="6">Lavadero</option>
              </select>
            </div>

            <!-- Cantidad de puestos -->
            <div class="form-group">
              <label for="cant_puestos">
                Cantidad de puestos
                <span *ngIf="isCantPuestosRequired()"> *</span>
              </label>
              <input
                type="number"
                id="cant_puestos"
                name="cant_puestos"
                [(ngModel)]="servicioPoloForm.datos.cant_puestos"
                #cantPuestos="ngModel"
                [class.is-invalid]="
                  isCantPuestosRequired() &&
                  cantPuestos.invalid &&
                  cantPuestos.touched
                "
                class="form-control"
              />
              <div
                *ngIf="
                  isCantPuestosRequired() &&
                  cantPuestos.invalid &&
                  cantPuestos.touched
                "
                class="text-danger"
              >
                Este campo es obligatorio para coworking.
              </div>
            </div>

            <!-- Metros cuadrados -->
            <div class="form-group">
              <label for="m2">
                Metros cuadrados (m2)
                <span *ngIf="isM2Required()"> *</span>
              </label>
              <input
                type="number"
                id="m2"
                name="m2"
                [(ngModel)]="servicioPoloForm.datos.m2"
                #m2Field="ngModel"
                [class.is-invalid]="
                  isM2Required() && m2Field.invalid && m2Field.touched
                "
                class="form-control"
              />
              <div
                *ngIf="isM2Required() && m2Field.invalid && m2Field.touched"
                class="text-danger"
              >
                Este campo es obligatorio para este tipo de servicio.
              </div>
            </div>

            <!-- Datos del propietario -->
            <div
              *ngIf="servicioPoloForm.propietario === 'propietario'"
              class="form-group"
            >
              <label>Nombre del propietario</label>
              <input
                type="text"
                [(ngModel)]="servicioPoloForm.datos.datos_prop.nombre"
                name="datos_prop_nombre"
                class="form-control"
              />

              <label>Contacto del propietario</label>
              <input
                type="text"
                [(ngModel)]="servicioPoloForm.datos.datos_prop.contacto"
                name="datos_prop_contacto"
                class="form-control"
              />
            </div>

            <!-- Datos del inquilino -->
            <div
              *ngIf="servicioPoloForm.propietario === 'inquilino'"
              class="form-group"
            >
              <label>Nombre del inquilino</label>
              <input
                type="text"
                [(ngModel)]="servicioPoloForm.datos.datos_inquilino.nombre"
                name="datos_inquilino_nombre"
                class="form-control"
              />

              <label>Contacto del inquilino</label>
              <input
                type="text"
                [(ngModel)]="servicioPoloForm.datos.datos_inquilino.contacto"
                name="datos_inquilino_contacto"
                class="form-control"
              />
            </div>
          </div>

          <!-- Botones -->
          <div class="form-actions">
            <button
              type="button"
              class="btn btn-secondary"
              (click)="resetForms()"
            >
              Cancelar
            </button>
            <button
              type="submit"
              class="btn btn-primary"
              [disabled]="loading || servicioFormRef.invalid"
            >
              {{ loading ? "Guardando..." : "Crear Servicio" }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </main>
</div>
